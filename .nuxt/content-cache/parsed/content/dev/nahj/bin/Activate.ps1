{"parsed":{"_id":"content:dev:nahj:bin:Activate.ps1","body":"<#\n.Synopsis\nActivate a Python virtual environment for the current PowerShell session.\n\n.Description\nPushes the python executable for a virtual environment to the front of the\n$Env:PATH environment variable and sets the prompt to signify that you are\nin a Python virtual environment. Makes use of the command line switches as\nwell as the `pyvenv.cfg` file values present in the virtual environment.\n\n.Parameter VenvDir\nPath to the directory that contains the virtual environment to activate. The\ndefault value for this is the parent of the directory that the Activate.ps1\nscript is located within.\n\n.Parameter Prompt\nThe prompt prefix to display when this virtual environment is activated. By\ndefault, this prompt is the name of the virtual environment folder (VenvDir)\nsurrounded by parentheses and followed by a single space (ie. '(.venv) ').\n\n.Example\nActivate.ps1\nActivates the Python virtual environment that contains the Activate.ps1 script.\n\n.Example\nActivate.ps1 -Verbose\nActivates the Python virtual environment that contains the Activate.ps1 script,\nand shows extra information about the activation as it executes.\n\n.Example\nActivate.ps1 -VenvDir C:\\Users\\MyUser\\Common\\.venv\nActivates the Python virtual environment located in the specified location.\n\n.Example\nActivate.ps1 -Prompt \"MyPython\"\nActivates the Python virtual environment that contains the Activate.ps1 script,\nand prefixes the current prompt with the specified string (surrounded in\nparentheses) while the virtual environment is active.\n\n.Notes\nOn Windows, it may be required to enable this Activate.ps1 script by setting the\nexecution policy for the user. You can do this by issuing the following PowerShell\ncommand:\n\nPS C:\\> Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser\n\nFor more information on Execution Policies: \nhttps://go.microsoft.com/fwlink/?LinkID=135170\n\n#>\nParam(\n    [Parameter(Mandatory = $false)]\n    [String]\n    $VenvDir,\n    [Parameter(Mandatory = $false)]\n    [String]\n    $Prompt\n)\n\n<# Function declarations --------------------------------------------------- #>\n\n<#\n.Synopsis\nRemove all shell session elements added by the Activate script, including the\naddition of the virtual environment's Python executable from the beginning of\nthe PATH variable.\n\n.Parameter NonDestructive\nIf present, do not remove this function from the global namespace for the\nsession.\n\n#>\nfunction global:deactivate ([switch]$NonDestructive) {\n    # Revert to original values\n\n    # The prior prompt:\n    if (Test-Path -Path Function:_OLD_VIRTUAL_PROMPT) {\n        Copy-Item -Path Function:_OLD_VIRTUAL_PROMPT -Destination Function:prompt\n        Remove-Item -Path Function:_OLD_VIRTUAL_PROMPT\n    }\n\n    # The prior PYTHONHOME:\n    if (Test-Path -Path Env:_OLD_VIRTUAL_PYTHONHOME) {\n        Copy-Item -Path Env:_OLD_VIRTUAL_PYTHONHOME -Destination Env:PYTHONHOME\n        Remove-Item -Path Env:_OLD_VIRTUAL_PYTHONHOME\n    }\n\n    # The prior PATH:\n    if (Test-Path -Path Env:_OLD_VIRTUAL_PATH) {\n        Copy-Item -Path Env:_OLD_VIRTUAL_PATH -Destination Env:PATH\n        Remove-Item -Path Env:_OLD_VIRTUAL_PATH\n    }\n\n    # Just remove the VIRTUAL_ENV altogether:\n    if (Test-Path -Path Env:VIRTUAL_ENV) {\n        Remove-Item -Path env:VIRTUAL_ENV\n    }\n\n    # Just remove VIRTUAL_ENV_PROMPT altogether.\n    if (Test-Path -Path Env:VIRTUAL_ENV_PROMPT) {\n        Remove-Item -Path env:VIRTUAL_ENV_PROMPT\n    }\n\n    # Just remove the _PYTHON_VENV_PROMPT_PREFIX altogether:\n    if (Get-Variable -Name \"_PYTHON_VENV_PROMPT_PREFIX\" -ErrorAction SilentlyContinue) {\n        Remove-Variable -Name _PYTHON_VENV_PROMPT_PREFIX -Scope Global -Force\n    }\n\n    # Leave deactivate function in the global namespace if requested:\n    if (-not $NonDestructive) {\n        Remove-Item -Path function:deactivate\n    }\n}\n\n<#\n.Description\nGet-PyVenvConfig parses the values from the pyvenv.cfg file located in the\ngiven folder, and returns them in a map.\n\nFor each line in the pyvenv.cfg file, if that line can be parsed into exactly\ntwo strings separated by `=` (with any amount of whitespace surrounding the =)\nthen it is considered a `key = value` line. The left hand string is the key,\nthe right hand is the value.\n\nIf the value starts with a `'` or a `\"` then the first and last character is\nstripped from the value before being captured.\n\n.Parameter ConfigDir\nPath to the directory that contains the `pyvenv.cfg` file.\n#>\nfunction Get-PyVenvConfig(\n    [String]\n    $ConfigDir\n) {\n    Write-Verbose \"Given ConfigDir=$ConfigDir, obtain values in pyvenv.cfg\"\n\n    # Ensure the file exists, and issue a warning if it doesn't (but still allow the function to continue).\n    $pyvenvConfigPath = Join-Path -Resolve -Path $ConfigDir -ChildPath 'pyvenv.cfg' -ErrorAction Continue\n\n    # An empty map will be returned if no config file is found.\n    $pyvenvConfig = @{ }\n\n    if ($pyvenvConfigPath) {\n\n        Write-Verbose \"File exists, parse `key = value` lines\"\n        $pyvenvConfigContent = Get-Content -Path $pyvenvConfigPath\n\n        $pyvenvConfigContent | ForEach-Object {\n            $keyval = $PSItem -split \"\\s*=\\s*\", 2\n            if ($keyval[0] -and $keyval[1]) {\n                $val = $keyval[1]\n\n                # Remove extraneous quotations around a string value.\n                if (\"'\"\"\".Contains($val.Substring(0, 1))) {\n                    $val = $val.Substring(1, $val.Length - 2)\n                }\n\n                $pyvenvConfig[$keyval[0]] = $val\n                Write-Verbose \"Adding Key: '$($keyval[0])'='$val'\"\n            }\n        }\n    }\n    return $pyvenvConfig\n}\n\n\n<# Begin Activate script --------------------------------------------------- #>\n\n# Determine the containing directory of this script\n$VenvExecPath = Split-Path -Parent $MyInvocation.MyCommand.Definition\n$VenvExecDir = Get-Item -Path $VenvExecPath\n\nWrite-Verbose \"Activation script is located in path: '$VenvExecPath'\"\nWrite-Verbose \"VenvExecDir Fullname: '$($VenvExecDir.FullName)\"\nWrite-Verbose \"VenvExecDir Name: '$($VenvExecDir.Name)\"\n\n# Set values required in priority: CmdLine, ConfigFile, Default\n# First, get the location of the virtual environment, it might not be\n# VenvExecDir if specified on the command line.\nif ($VenvDir) {\n    Write-Verbose \"VenvDir given as parameter, using '$VenvDir' to determine values\"\n}\nelse {\n    Write-Verbose \"VenvDir not given as a parameter, using parent directory name as VenvDir.\"\n    $VenvDir = $VenvExecDir.Parent.FullName.TrimEnd(\"\\\\/\")\n    Write-Verbose \"VenvDir=$VenvDir\"\n}\n\n# Next, read the `pyvenv.cfg` file to determine any required value such\n# as `prompt`.\n$pyvenvCfg = Get-PyVenvConfig -ConfigDir $VenvDir\n\n# Next, set the prompt from the command line, or the config file, or\n# just use the name of the virtual environment folder.\nif ($Prompt) {\n    Write-Verbose \"Prompt specified as argument, using '$Prompt'\"\n}\nelse {\n    Write-Verbose \"Prompt not specified as argument to script, checking pyvenv.cfg value\"\n    if ($pyvenvCfg -and $pyvenvCfg['prompt']) {\n        Write-Verbose \"  Setting based on value in pyvenv.cfg='$($pyvenvCfg['prompt'])'\"\n        $Prompt = $pyvenvCfg['prompt'];\n    }\n    else {\n        Write-Verbose \"  Setting prompt based on parent's directory's name. (Is the directory name passed to venv module when creating the virtual environment)\"\n        Write-Verbose \"  Got leaf-name of $VenvDir='$(Split-Path -Path $venvDir -Leaf)'\"\n        $Prompt = Split-Path -Path $venvDir -Leaf\n    }\n}\n\nWrite-Verbose \"Prompt = '$Prompt'\"\nWrite-Verbose \"VenvDir='$VenvDir'\"\n\n# Deactivate any currently active virtual environment, but leave the\n# deactivate function in place.\ndeactivate -nondestructive\n\n# Now set the environment variable VIRTUAL_ENV, used by many tools to determine\n# that there is an activated venv.\n$env:VIRTUAL_ENV = $VenvDir\n\nif (-not $Env:VIRTUAL_ENV_DISABLE_PROMPT) {\n\n    Write-Verbose \"Setting prompt to '$Prompt'\"\n\n    # Set the prompt to include the env name\n    # Make sure _OLD_VIRTUAL_PROMPT is global\n    function global:_OLD_VIRTUAL_PROMPT { \"\" }\n    Copy-Item -Path function:prompt -Destination function:_OLD_VIRTUAL_PROMPT\n    New-Variable -Name _PYTHON_VENV_PROMPT_PREFIX -Description \"Python virtual environment prompt prefix\" -Scope Global -Option ReadOnly -Visibility Public -Value $Prompt\n\n    function global:prompt {\n        Write-Host -NoNewline -ForegroundColor Green \"($_PYTHON_VENV_PROMPT_PREFIX) \"\n        _OLD_VIRTUAL_PROMPT\n    }\n    $env:VIRTUAL_ENV_PROMPT = $Prompt\n}\n\n# Clear PYTHONHOME\nif (Test-Path -Path Env:PYTHONHOME) {\n    Copy-Item -Path Env:PYTHONHOME -Destination Env:_OLD_VIRTUAL_PYTHONHOME\n    Remove-Item -Path Env:PYTHONHOME\n}\n\n# Add the venv to the PATH\nCopy-Item -Path Env:PATH -Destination Env:_OLD_VIRTUAL_PATH\n$Env:PATH = \"$VenvExecDir$([System.IO.Path]::PathSeparator)$Env:PATH\"\n"},"hash":"v0560E0WuP"}