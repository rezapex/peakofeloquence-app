{"parsed":{"_id":"content:dev:nahj:lib:python3.12:site-packages:pip:_internal:network:xmlrpc.py","body":"\"\"\"xmlrpclib.Transport implementation\n\"\"\"\n\nimport logging\nimport urllib.parse\nimport xmlrpc.client\nfrom typing import TYPE_CHECKING, Tuple\n\nfrom pip._internal.exceptions import NetworkConnectionError\nfrom pip._internal.network.session import PipSession\nfrom pip._internal.network.utils import raise_for_status\n\nif TYPE_CHECKING:\n    from xmlrpc.client import _HostType, _Marshallable\n\n    from _typeshed import SizedBuffer\n\nlogger = logging.getLogger(__name__)\n\n\nclass PipXmlrpcTransport(xmlrpc.client.Transport):\n    \"\"\"Provide a `xmlrpclib.Transport` implementation via a `PipSession`\n    object.\n    \"\"\"\n\n    def __init__(\n        self, index_url: str, session: PipSession, use_datetime: bool = False\n    ) -> None:\n        super().__init__(use_datetime)\n        index_parts = urllib.parse.urlparse(index_url)\n        self._scheme = index_parts.scheme\n        self._session = session\n\n    def request(\n        self,\n        host: \"_HostType\",\n        handler: str,\n        request_body: \"SizedBuffer\",\n        verbose: bool = False,\n    ) -> Tuple[\"_Marshallable\", ...]:\n        assert isinstance(host, str)\n        parts = (self._scheme, host, handler, None, None, None)\n        url = urllib.parse.urlunparse(parts)\n        try:\n            headers = {\"Content-Type\": \"text/xml\"}\n            response = self._session.post(\n                url,\n                data=request_body,\n                headers=headers,\n                stream=True,\n            )\n            raise_for_status(response)\n            self.verbose = verbose\n            return self.parse_response(response.raw)\n        except NetworkConnectionError as exc:\n            assert exc.response\n            logger.critical(\n                \"HTTP error %s while getting %s\",\n                exc.response.status_code,\n                url,\n            )\n            raise\n"},"hash":"VF2twrtc2i"}