{"version":3,"file":"defineOgImage-DSkpf_RL.js","sources":["../../../../node_modules/nuxt-og-image/dist/runtime/nitro/util/kit.mjs","../../../../node_modules/nuxt-og-image/dist/runtime/nuxt/composables/defineOgImage.mjs"],"sourcesContent":["import { createRouter as createRadixRouter, toRouteMatcher } from \"radix3\";\nimport { defu } from \"defu\";\nimport { withoutBase, withoutTrailingSlash } from \"ufo\";\nimport { hash } from \"ohash\";\nimport { useRuntimeConfig } from \"#imports\";\nexport function fetchIsland(e, component, props) {\n  const hashId = hash([component, props]);\n  return e.$fetch(`/__nuxt_island/${component}_${hashId}.json`, {\n    params: {\n      props: JSON.stringify(props)\n    }\n  });\n}\nexport function withoutQuery(path) {\n  return path.split(\"?\")[0];\n}\nexport function createNitroRouteRuleMatcher() {\n  const { nitro, app } = useRuntimeConfig();\n  const _routeRulesMatcher = toRouteMatcher(\n    createRadixRouter({\n      routes: Object.fromEntries(\n        Object.entries(nitro?.routeRules || {}).map(([path, rules]) => [withoutTrailingSlash(path), rules])\n      )\n    })\n  );\n  return (path) => {\n    return defu({}, ..._routeRulesMatcher.matchAll(\n      // radix3 does not support trailing slashes\n      withoutBase(withoutTrailingSlash(withoutQuery(path)), app.baseURL)\n    ).reverse());\n  };\n}\n","import { defu } from \"defu\";\nimport { appendHeader } from \"h3\";\nimport { getOgImagePath, separateProps, useOgImageRuntimeConfig } from \"../../shared.mjs\";\nimport { createOgImageMeta, normaliseOptions } from \"../utils.mjs\";\nimport { createNitroRouteRuleMatcher } from \"../../nitro/util/kit.mjs\";\nimport { useNuxtApp, useRequestEvent, useRoute } from \"#imports\";\nexport function defineOgImage(_options = {}) {\n  if (!import.meta.server)\n    return;\n  const nuxtApp = useNuxtApp();\n  const ogImageInstances = nuxtApp.ssrContext._ogImageInstances || [];\n  const route = useRoute();\n  const basePath = route.path || \"/\";\n  const routeRuleMatcher = createNitroRouteRuleMatcher();\n  const routeRules = routeRuleMatcher(basePath).ogImage;\n  if (!_options || nuxtApp.ssrContext?.event.context._nitro?.routeRules?.ogImage === false || typeof routeRules !== \"undefined\" && routeRules === false) {\n    ogImageInstances.forEach((e) => {\n      e.dispose();\n    });\n    nuxtApp.ssrContext._ogImageInstances = void 0;\n    return;\n  }\n  const options = normaliseOptions({\n    ..._options\n  });\n  if (route.query)\n    options._query = route.query;\n  const { defaults } = useOgImageRuntimeConfig();\n  const resolvedOptions = normaliseOptions(defu(separateProps(_options), separateProps(routeRules), defaults));\n  if (_options.url) {\n    createOgImageMeta(null, options, resolvedOptions, nuxtApp.ssrContext);\n  } else {\n    const path = getOgImagePath(basePath, resolvedOptions);\n    if (import.meta.prerender)\n      appendHeader(useRequestEvent(), \"x-nitro-prerender\", path);\n    createOgImageMeta(path, options, resolvedOptions, nuxtApp.ssrContext);\n  }\n}\n"],"names":["createRadixRouter"],"mappings":";;;;;AAaO,SAAS,aAAa,MAAM;AACjC,SAAO,KAAK,MAAM,GAAG,EAAE,CAAC;AAC1B;AACO,SAAS,8BAA8B;AAC5C,QAAM,EAAE,OAAO,IAAK,IAAG,iBAAgB;AACvC,QAAM,qBAAqB;AAAA,IACzBA,aAAkB;AAAA,MAChB,QAAQ,OAAO;AAAA,QACb,OAAO,SAAQ,+BAAO,eAAc,CAAE,CAAA,EAAE,IAAI,CAAC,CAAC,MAAM,KAAK,MAAM,CAAC,qBAAqB,IAAI,GAAG,KAAK,CAAC;AAAA,MACnG;AAAA,IACP,CAAK;AAAA,EACL;AACE,SAAO,CAAC,SAAS;AACf,WAAO,KAAK,CAAA,GAAI,GAAG,mBAAmB;AAAA;AAAA,MAEpC,YAAY,qBAAqB,aAAa,IAAI,CAAC,GAAG,IAAI,OAAO;AAAA,IACvE,EAAM,QAAS,CAAA;AAAA,EACf;AACA;ACzBO,SAAS,cAAc,WAAW,IAAI;;AAG3C,QAAM,UAAU;AAChB,QAAM,mBAAmB,QAAQ,WAAW,qBAAqB,CAAA;AACjE,QAAM,QAAQ;AACd,QAAM,WAAW,MAAM,QAAQ;AAC/B,QAAM,mBAAmB;AACzB,QAAM,aAAa,iBAAiB,QAAQ,EAAE;AAC9C,MAAI,CAAC,cAAY,yBAAQ,eAAR,mBAAoB,MAAM,QAAQ,WAAlC,mBAA0C,eAA1C,mBAAsD,aAAY,SAAS,OAAO,eAAe,eAAe,eAAe,OAAO;AACrJ,qBAAiB,QAAQ,CAAC,MAAM;AAC9B,QAAE,QAAO;AAAA,IACf,CAAK;AACD,YAAQ,WAAW,oBAAoB;AACvC;AAAA,EACD;AACD,QAAM,UAAU,iBAAiB;AAAA,IAC/B,GAAG;AAAA,EACP,CAAG;AACD,MAAI,MAAM;AACR,YAAQ,SAAS,MAAM;AACzB,QAAM,EAAE,aAAa;AACrB,QAAM,kBAAkB,iBAAiB,KAAK,cAAc,QAAQ,GAAG,cAAc,UAAU,GAAG,QAAQ,CAAC;AAC3G,MAAI,SAAS,KAAK;AAChB,sBAAkB,MAAM,SAAS,iBAAiB,QAAQ,UAAU;AAAA,EACxE,OAAS;AACL,UAAM,OAAO,eAAe,UAAU,eAAe;AACrD,QAAI,YAAY;AACd,mBAAa,gBAAe,GAAI,qBAAqB,IAAI;AAC3D,sBAAkB,MAAM,SAAS,iBAAiB,QAAQ,UAAU;AAAA,EACrE;AACH;","x_google_ignoreList":[0,1]}