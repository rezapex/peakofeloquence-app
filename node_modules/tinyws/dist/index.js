import{WebSocketServer}from"ws";const tinyws=(wsOptions,wss=new WebSocketServer({...wsOptions,noServer:!0}))=>async(req,_,next)=>{0===(req.headers.upgrade||"").split(",").map((s=>s.trim())).indexOf("websocket")&&(req.ws=()=>new Promise((resolve=>{wss.handleUpgrade(req,req.socket,Buffer.alloc(0),(ws=>{wss.emit("connection",ws,req),resolve(ws)}))}))),await next()};export{tinyws};
